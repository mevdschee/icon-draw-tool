
<html>
<head>
<title>Icon Draw Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.6/zepto.min.js"></script>
</head>
<body style="margin:0; width: 100%;">
<div id="panel" style="position: fixed; right:0; height: 100%; color: gray; background-color: rgba(205,205,205,.7); padding: 15px; z-index: 999;"></div>
  <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" transform="scale(5)">
    <defs>
      <pattern id="smallGrid" width="10" height="10" patternUnits="userSpaceOnUse">
        <path d="M 10 0 L 0 0 0 10" fill="none" stroke="gray" stroke-width="0.5"/>
      </pattern>
      <pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse">
        <rect width="100" height="100" fill="url(#smallGrid)"/>
        <path d="M 100 0 L 0 0 0 100" fill="none" stroke="gray" stroke-width="1"/>
      </pattern>
      <marker id="marker" refX="1" refY="1">
        <rect width="2" height="2" fill="blue" />
      </marker>
    </defs>
    <rect width="100%" height="100%" fill="url(#grid)" />
    <path id="points" d="" marker-start="url(#marker)" marker-mid="url(#marker)" marker-end="url(#marker)" stroke="silver" fill="none" />
    <path id="path" d="" marker-start="url(#marker)" marker-mid="url(#marker)" marker-end="url(#marker)" fill="none" stroke="blue" />
    <path id="fill" d="" fill="blue" stroke="none" />
    <rect id="cursor" x="10" y="10" width="4" height="4" stroke="red" fill="none" transform="translate(-2,-2)"/>
    <rect id="point" x="10" y="10" width="2" height="2" stroke="none" fill="red" transform="translate(-1,-1)" />
  </svg>
<script>
var e = document.getElementById('input');
var d = document.getElementById('drawing');
var modes = ['M','L','Q','C'];
var lengths = [1,1,2,3];
var px = 40;
var py = 10;
//var points = [[0,10,10],[1,10,40],[1,20,30],[1,50,60],[1,20,90],[1,10,80],[1,10,110],[1,40,110],[1,30,100],[1,60,70],[1,90,100],[1,80,110],[1,110,110],[1,110,80],[1,100,90],[1,70,60],[1,100,30],[1,110,40],[1,110,10],[1,80,10],[1,90,20],[1,60,50],[1,30,20],[1,40,10],[1,40,10]]; 
var points = [[0,10,10],[1,10,40],[1,20,30],[2,20,90,50,60],[1,10,80],[1,10,110],[1,40,110],[1,30,100],[1,60,70],[1,90,100],[1,80,110],[1,110,110],[1,110,80],[1,100,90],[1,70,60],[1,100,30],[1,110,40],[1,110,10],[1,80,10],[1,90,20],[1,60,50],[1,30,20],[1,40,10],[1,40,10]]; 
var fill = 0;
var selected = points.length-1;
var point = 0;

function getFirstCurveDefault(p1,p2) {
  return [0,p1[1],p2[2]];
}
function getSecondCurveDefault(p1,p2) {
  return [0,p2[1],p1[2]];
}
function toggleMode() {
  if (selected<1) {
    points[selected][0] = 0;
  } else {
    points[selected][0]++;
    points[selected][0]%=modes.length;
    if (points[selected][0]>=2 && points[selected].length<5) {
      var p = getFirstCurveDefault(points[selected-1],points[selected]);
      points[selected][3] = p[1];
      points[selected][4] = p[2];
    } 
    if (points[selected][0]>=3 && points[selected].length<7) {
      var p = getSecondCurveDefault(points[selected-1],points[selected]);
      points[selected][5] = p[1];
      points[selected][6] = p[2];
    }
  }
}
function nextPoint() {
   if (selected+1<points.length) {
     incrementSelected();
     point=0;
     px=points[selected][1];
     py=points[selected][2];
   } else {
     // prevent double entry
     if (selected-1>=0 && px==points[selected-1][1] && py==points[selected-1][2]) return;
     points.push([1,px,py]); 
     incrementSelected();
     point=0;
   } 
}
function selectControlPoint(num) {
  point = point==num?0:num;
  px=points[selected][point*2+1];
  py=points[selected][point*2+2];  
}
function previousPoint() {
  decrementSelected();
  point=0;
  px=points[selected][1];
  py=points[selected][2];
}
function deletePoint() {
  if (points.length>1) points.splice(selected,1);
  if (selected>=points.length) decrementSelected();
  if (selected==0) points[selected][0]=0;
  px=points[selected][1];
  py=points[selected][2];
}
function duplicatePoint() {
  var p=points[selected-1]; 
  if (px==p[1]&&py==p[2]) return;
  px=(p[1]+px)/2;
  py=(p[2]+py)/2;
  points.splice(selected,0,p.slice(0));
}
function incrementSelected() {
  if (points.length==0) return;
  selected=(selected+1)%(points.length);
}
function decrementSelected() {
  if (points.length==0) return;
  selected=(selected+points.length-1)%(points.length);
}
function reset() {
  if (!confirm('Are you sure?')) return; 
  points=[[0,px,py]];
  fill=0;
  selected=0;
}
function onKeyPress(e) {
  var evt = window.event? event : e;
  var key = evt.keyCode? evt.keyCode : evt.charCode;
  console.log(key,'pressed');
  var step = evt.ctrlKey?100:evt.shiftKey?1:10;
  switch(key) {
    case 49: 
    case 50: 
    case 51: selectControlPoint(key-48); break;
    case 40: py+=step; break;
    case 38: if (py>=step) py-=step; else py=0; break; 
    case 37: if (px>=step) px-=step; else px=0; break;
    case 39: px+=step; break;
    case 102: fill=(fill==1?0:1); break;
    case 8: previousPoint(); break;
    case 46: deletePoint(); break;
    case 13: nextPoint(); break;
    case 100: duplicatePoint(); break; 
    case 32: toggleMode(); break;
    case 27: reset(); break;
  }
  points[selected][point*2+1]=px;
  points[selected][point*2+2]=py;
  draw();
}
function draw() {
  var path='';
  for (var i=0;i<points.length;i++) {
    var p = points[i];
    path+=modes[p[0]];
    switch(p[0]) {
      case 0: path+=p[1]+','+p[2]; break;
      case 1: path+=p[1]+','+p[2]; break;
      case 2: path+=p[3]+','+p[4]+' '+p[1]+','+p[2]; break;
      case 3: path+=p[3]+','+p[4]+' '+p[5]+','+p[6]+' '+p[1]+','+p[2];break;
    }
  }
  $('#path').attr('d',fill?'':path);
  $('#fill').attr('d',fill?path:'');
  path='';
  if (points[selected][0]==0) {
    $('#point').attr('x',points[selected][1]).attr('y',points[selected][2]);
  } else {
    $('#point').attr('x',points[selected-1][1]).attr('y',points[selected-1][2]);
  }
  if (points[selected][0]==2) {
    path+='M'+points[selected-1][1]+','+points[selected-1][2];
    path+='L'+points[selected][3]+','+points[selected][4];
    path+='M'+points[selected][1]+','+points[selected][2];
    path+='L'+points[selected][3]+','+points[selected][4];
  }
  if (points[selected][0]==3) {
    path+='M'+points[selected-1][1]+','+points[selected-1][2];
    path+='L'+points[selected][3]+','+points[selected][4];
    path+='M'+points[selected][1]+','+points[selected][2];
    path+='L'+points[selected][5]+','+points[selected][6];
  }
  $('#points').attr('d',fill?'':path);
  $('#cursor').attr('x',px).attr('y',py);
  updatePanel();
}
function updatePanel() {
  var segments=[];
  for (var i=0;i<points.length;i++) {
    var p = points[i];
    var segment=modes[p[0]]+' ';
    if (i==selected) segment+='<span style="color: red;">';
    segment+=p[1]+','+p[2];
    if (i==selected) segment+='</span>';
    switch(p[0]) {
      case 0: break;
      case 1: break;
      case 2: segment+="\n  "+p[3]+','+p[4]; break;
      case 3: segment+="\n  "+p[3]+','+p[4]+"\n  "+p[5]+','+p[6]; break;
    }
    segments[i]=segment;
  }
  var html = '<pre>';
  for (var i=0;i<segments.length;i++) {
    html+='<span style="color: '+(i==selected?'black':'auto')+';">'+segments[i]+'</span>'+"\n";
  }
  html+='</pre>';
  $('#panel').html(html);
}
document.onkeypress = onKeyPress;
draw();
</script>
</body>
</html>
